---
layout:     post
title:      wiki中文语料的word2vec模型构建
subtitle:   利用Python构建Wiki中文语料词向量模型
date:       2019-08-20
author:     DiCaprio
header-img: img/home-bg-geek.jpg
catalog: true
tags:
    - 机器学习
    - NLP
    - word2vec
---

<div id="cnblogs_post_body" class="blogpost-body ">
    <p><strong><span style="font-size: 16px;">一、利用wiki中文语料进行word2vec模型构建</span></strong></p>
<p><span style="font-size: 15px;"><strong>　1）数据获取</strong></span></p>
<p><span style="font-size: 16px;"><span style="font-size: 15px;">　　<span style="font-size: 14px;">到wiki官网下载中文语料，下载完成后会得到命名为<strong>zhwiki-latest-pages-articles.xml.bz2</strong>的文件，里面是一个XML文件</span></span></span></p>
<p><span style="font-size: 14px;">　　下载地址如下：<span style="color: #0000ff;"><a href="https://link.jianshu.com/?t=https://dumps.wikimedia.org/zhwiki/latest/zhwiki-latest-pages-articles.xml.bz2" rel="nofollow" target="_blank"><span style="color: #0000ff;">https://dumps.wikimedia.org/zhwiki/latest/zhwiki-latest-pages-articles.xml.bz2</span></a></span></span></p>
<p><span style="font-size: 14px;"><span style="color: #0000ff;"><span style="color: #0000ff;">　　<span style="color: #000000;">其中：<span style="color: #0000ff;"><a href="https://dumps.wikimedia.org/zhwiki/latest/" target="_blank"><span style="color: #0000ff;">https://dumps.wikimedia.org/zhwiki/latest/</span></a></span>提供wiki各种文件下载，而且在不停的更新</span></span></span></span></p>
<p><span style="font-size: 14px;">　　本人已经下载并上传百度云盘，链接：<span style="color: #0000ff;"><a href="https://pan.baidu.com/s/1kzMwGwVR4h0wuOYU70aUhA" target="_blank"><span style="color: #0000ff;">https://pan.baidu.com/s/1kzMwGwVR4h0wuOYU70aUhA</span></a></span>&nbsp;提取码：2axt&nbsp;</span></p>
<p><span style="font-size: 14px;">　　然后在桌面新建<strong>wiki中文语料的word2vec模型构建</strong>文件夹，将下载的压缩文件放在内，进入<strong>wiki中文语料的word2vec模型构建</strong>文件夹，按住<strong>shift+右键，</strong>选择<strong>在此处打开命令窗口</strong></span></p>
<p><span style="font-size: 14px;"><em><strong>　　</strong></em>输入<strong>jupyter notebook，</strong>新建一个名为：<strong>wiki_word2vec_test</strong>的脚本文件：</span></p>
<p style="text-align: center;"><span style="font-size: 14px;"><img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190123165057080-1747419925.png" alt=""></span></p>
<p style="text-align: center;">&nbsp;</p>
<p style="text-align: left;"><span style="font-size: 14px;"><span style="font-size: 15px;"><strong>　2）</strong></span></span><span style="font-size: 15px;"><strong>将XML的Wiki数据转换为text格式</strong></span></p>
<p style="text-align: left;"><span style="font-size: 15px;"><strong>　　</strong><span style="font-size: 14px;">使用<strong>gensim.corpora</strong>中的<strong>WikiCorpus</strong>函数来处理维基百科的数据，转换后生成的文件<strong>wiki.zh.txt</strong></span></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_883488" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">logging</code></div><div class="line number2 index1 alt1"><code class="python keyword">import</code> <code class="python plain">sys</code></div><div class="line number3 index2 alt2"><code class="python keyword">import</code> <code class="python plain">os</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="python keyword">from</code> <code class="python plain">gensim.corpora </code><code class="python keyword">import</code> <code class="python plain">WikiCorpus</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="python plain">program </code><code class="python keyword">=</code> <code class="python plain">os.path.basename( sys.argv[</code><code class="python value">0</code><code class="python plain">] )</code></div><div class="line number8 index7 alt1"><code class="python plain">logger </code><code class="python keyword">=</code> <code class="python plain">logging.getLogger(program)</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="python plain">logging.basicConfig(</code><code class="python functions">format</code><code class="python keyword">=</code><code class="python string">'%(asctime)s: %(levelname)s: %(message)s'</code><code class="python plain">)</code></div><div class="line number11 index10 alt2"><code class="python plain">logging.root.setLevel(level</code><code class="python keyword">=</code><code class="python plain">logging.INFO)</code></div><div class="line number12 index11 alt1"><code class="python plain">logger.info( </code><code class="python string">"running %s"</code> <code class="python keyword">%</code> <code class="python string">' '</code><code class="python plain">.join(sys.argv) )</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="python plain">inp </code><code class="python keyword">=</code> <code class="python string">'zhwiki-latest-pages-articles.xml.bz2'</code></div><div class="line number15 index14 alt2"><code class="python plain">outp </code><code class="python keyword">=</code> <code class="python string">'wiki.zh.txt'</code></div><div class="line number16 index15 alt1"><code class="python plain">space </code><code class="python keyword">=</code> <code class="python string">' '</code></div><div class="line number17 index16 alt2"><code class="python plain">i </code><code class="python keyword">=</code> <code class="python value">0</code></div><div class="line number18 index17 alt1"><code class="python plain">output </code><code class="python keyword">=</code> <code class="python functions">open</code><code class="python plain">(outp, </code><code class="python string">'w'</code><code class="python plain">, encoding</code><code class="python keyword">=</code><code class="python string">'utf-8'</code><code class="python plain">)</code></div><div class="line number19 index18 alt2"><code class="python comments">#gensim里的维基百科处理类WikiCorpu</code></div><div class="line number20 index19 alt1"><code class="python plain">wiki </code><code class="python keyword">=</code> <code class="python plain">WikiCorpus(inp, lemmatize</code><code class="python keyword">=</code><code class="python color1">False</code><code class="python plain">, dictionary</code><code class="python keyword">=</code><code class="python plain">[] )</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="python comments">#通过get_texts将维基里的每篇文章转换为1行text文本，并且去掉了标点符号等内容</code></div><div class="line number23 index22 alt2"><code class="python keyword">for</code> <code class="python plain">text </code><code class="python keyword">in</code> <code class="python plain">wiki.get_texts():</code></div><div class="line number24 index23 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">output.write( space.join(text) </code><code class="python keyword">+</code> <code class="python string">'\n'</code> <code class="python plain">)</code></div><div class="line number25 index24 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">i </code><code class="python keyword">+</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number26 index25 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">( i </code><code class="python keyword">%</code> <code class="python value">10000</code> <code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">0</code><code class="python plain">):</code></div><div class="line number27 index26 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">logger.info(</code><code class="python string">'Saved '</code> <code class="python keyword">+</code> <code class="python functions">str</code><code class="python plain">(i) </code><code class="python keyword">+</code> <code class="python string">' articles.'</code><code class="python plain">)</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="python plain">output.close()</code></div><div class="line number30 index29 alt1"><code class="python plain">logger.info(</code><code class="python string">'Finished Saved '</code> <code class="python keyword">+</code> <code class="python functions">str</code><code class="python plain">(i) </code><code class="python keyword">+</code> <code class="python string">' articles.'</code><code class="python plain">)</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>　　<span style="font-size: 14px;">从下面的结果看27min处理了331588条数据，还是比较慢的，已经将<strong>wiki.zh.txt</strong>上传云盘，并且被压缩：</span></p>
<p>　　<span style="font-size: 14px;">链接：<span style="color: #0000ff;"><a href="https://pan.baidu.com/s/1g7d87ztvAdr8CZd2rCnvOg" target="_blank"><span style="color: #0000ff;">https://pan.baidu.com/s/1g7d87ztvAdr8CZd2rCnvOg</span></a></span>&nbsp;提取码：42x5&nbsp;</span></p>
<p style="text-align: center;"><span style="font-size: 15px;"><span style="font-size: 14px;"><em><strong><img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190123174213801-1316919969.png" alt=""></strong></em></span></span></p>
<p style="text-align: left;">&nbsp;</p>
<p><span style="font-size: 15px;"><strong>　3）中文繁体转简体</strong></span></p>
<p><span style="font-size: 15px;"><strong>　　</strong><span style="font-size: 14px;">Wiki中文语料中包含了很多繁体字，需要转成简体字再进行处理，这里使用到了OpenCC工具进行转换</span></span></p>
<p><span style="font-size: 15px;"><span style="font-size: 14px;">　　</span></span><span style="font-size: 14px;">安装OpenCC：下载对应版本的OpenCC，<span style="color: #0000ff;"><a href="https://bintray.com/package/files/byvoid/opencc/OpenCC" rel="nofollow"><span style="color: #0000ff;">https://bintray.com/package/files/byvoid/opencc/OpenCC</span></a></span>，本人选择的是win 64位</span></p>
<p style="text-align: center;"><img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190123175051953-1926127284.png" alt=""></p>
<p style="text-align: left;">　　<span style="font-size: 14px;">下载解压后，在<strong>wiki中文语料的word2vec模型构建</strong>文件夹下打开dos窗口：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_515073" class="syntaxhighlighter  bash"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">opencc -i wiki.zh.txt -o wiki.zh.simp.txt -c t2s.json</code></div><div class="line number2 index1 alt1"><code class="bash comments">#注意可以添加上opencc的绝对路径，t2s.json也要加绝对路径</code></div></div></td></tr></tbody></table></div></div>
</div>
<p style="text-align: center;">　　<img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190123181424416-579861840.png" alt=""></p>
<p>　　<span style="font-size: 14px;">则会得到文件<strong>wiki.zh.simp.txt</strong>，即转成了简体的中文，由于文件过大，无法直接打开查看，我们使用代码查看前2行：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_898165" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">codecs,sys</code></div><div class="line number2 index1 alt1"><code class="python plain">i </code><code class="python keyword">=</code> <code class="python value">0</code></div><div class="line number3 index2 alt2"><code class="python plain">f </code><code class="python keyword">=</code> <code class="python plain">codecs.</code><code class="python functions">open</code><code class="python plain">(</code><code class="python string">'wiki.zh.txt'</code><code class="python plain">,</code><code class="python string">'r'</code><code class="python plain">,encoding</code><code class="python keyword">=</code><code class="python string">"utf-8"</code><code class="python plain">)</code></div><div class="line number4 index3 alt1"><code class="python keyword">for</code> <code class="python plain">eachline </code><code class="python keyword">in</code> <code class="python plain">f:</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">i </code><code class="python keyword">+</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(i &lt; </code><code class="python value">3</code><code class="python plain">):</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(eachline)</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">break</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>　　<span style="font-size: 14px;">可以看出有很多繁体字：</span></p>
<p style="text-align: center;"><img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190123181710272-255263629.png" alt=""></p>
<p style="text-align: left;">　　<span style="font-size: 14px;">我们再来看看繁体转简体后：</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_766109" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">codecs,sys</code></div><div class="line number2 index1 alt1"><code class="python plain">i </code><code class="python keyword">=</code> <code class="python value">0</code></div><div class="line number3 index2 alt2"><code class="python plain">f </code><code class="python keyword">=</code> <code class="python plain">codecs.</code><code class="python functions">open</code><code class="python plain">(</code><code class="python string">'wiki.zh.simp.txt'</code><code class="python plain">,</code><code class="python string">'r'</code><code class="python plain">,encoding</code><code class="python keyword">=</code><code class="python string">"utf-8"</code><code class="python plain">)</code></div><div class="line number4 index3 alt1"><code class="python keyword">for</code> <code class="python plain">eachline </code><code class="python keyword">in</code> <code class="python plain">f:</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">i </code><code class="python keyword">+</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(i &lt; </code><code class="python value">3</code><code class="python plain">):</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(eachline)</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">break</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>　　<span style="font-size: 14px;">是不是都看懂了呢？</span></p>
<p style="text-align: center;"><span style="font-size: 14px;"><img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190123181912940-2098618824.png" alt=""></span></p>
<p>　　<span style="font-size: 14px;">其中的<strong>wiki.zh.simp.txt</strong>简体文件以及被我压缩，并上传至云盘：</span></p>
<p><span style="font-size: 14px;">　　链接：<span style="color: #0000ff;"><a href="https://pan.baidu.com/s/1Gx1iWORvKvmd5AzaZY3raw" target="_blank"><span style="color: #0000ff;">https://pan.baidu.com/s/1Gx1iWORvKvmd5AzaZY3raw</span></a></span>&nbsp;提取码：45k5</span></p>
<p>&nbsp;</p>
<p><span style="font-size: 15px;"><strong>　4）jieba分词</strong></span></p>
<p><span style="font-size: 15px;"><strong>　　</strong><span style="font-size: 14px;">本例中采用结巴分词对字体简化后的wiki中文语料数据集进行分词。由于此语料已经去除了标点符号，因此在分词程序中无需进行清洗操作，可直接分词</span></span></p>
<p><span style="font-size: 14px;">　　若是自己采集的数据还需进行标点符号去除和去除停用词的操作</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_748678" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">jieba</code></div><div class="line number2 index1 alt1"><code class="python keyword">import</code> <code class="python plain">jieba.analyse</code></div><div class="line number3 index2 alt2"><code class="python keyword">import</code> <code class="python plain">codecs</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="python keyword">def</code> <code class="python plain">prepareData(sourceFile, targetFile):</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">f </code><code class="python keyword">=</code><code class="python plain">codecs.</code><code class="python functions">open</code><code class="python plain">(sourceFile, </code><code class="python string">'r'</code><code class="python plain">, encoding</code><code class="python keyword">=</code><code class="python string">'utf-8'</code><code class="python plain">)</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">target </code><code class="python keyword">=</code> <code class="python plain">codecs.</code><code class="python functions">open</code><code class="python plain">(targetFile, </code><code class="python string">'w'</code><code class="python plain">, encoding</code><code class="python keyword">=</code><code class="python string">'utf-8'</code><code class="python plain">)</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">( </code><code class="python string">'open source file: '</code><code class="python keyword">+</code> <code class="python plain">sourceFile )</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">( </code><code class="python string">'open target file: '</code><code class="python keyword">+</code> <code class="python plain">targetFile )</code></div><div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">lineNum </code><code class="python keyword">=</code> <code class="python value">0</code></div><div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">for</code> <code class="python plain">eachline </code><code class="python keyword">in</code> <code class="python plain">f:</code></div><div class="line number13 index12 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">lineNum </code><code class="python keyword">+</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number14 index13 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">lineNum </code><code class="python keyword">%</code> <code class="python value">1000</code> <code class="python keyword">=</code><code class="python keyword">=</code> <code class="python value">0</code><code class="python plain">:</code></div><div class="line number15 index14 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(</code><code class="python string">'---processing '</code><code class="python plain">, sourceFile, lineNum,</code><code class="python string">' article---'</code><code class="python plain">)</code></div><div class="line number16 index15 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">seg_list </code><code class="python keyword">=</code> <code class="python plain">jieba.cut(eachline, cut_all</code><code class="python keyword">=</code><code class="python color1">False</code><code class="python plain">)</code></div><div class="line number17 index16 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">line_seg </code><code class="python keyword">=</code> <code class="python string">' '</code><code class="python plain">.join(seg_list)</code></div><div class="line number18 index17 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">target.write(line_seg</code><code class="python keyword">+</code> <code class="python string">'\n'</code><code class="python plain">)</code></div><div class="line number19 index18 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(</code><code class="python string">'---Well Done!!!---'</code> <code class="python keyword">*</code> <code class="python value">4</code><code class="python plain">)</code></div><div class="line number20 index19 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">f.close()</code></div><div class="line number21 index20 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">target.close()</code></div><div class="line number22 index21 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number23 index22 alt2"><code class="python plain">sourceFile </code><code class="python keyword">=</code> <code class="python string">'wiki.zh.simp.txt'</code></div><div class="line number24 index23 alt1"><code class="python plain">targetFile </code><code class="python keyword">=</code> <code class="python string">'wiki.zh.simp.seg.txt'</code></div><div class="line number25 index24 alt2"><code class="python plain">prepareData(sourceFile, targetFile)</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>&nbsp;</p>
<p>　　<span style="font-size: 14px;">查看分词结果文件-</span><span style="font-size: 14px;"><strong>wiki.zh.simp.seg.txt</strong></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_568967" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">codecs,sys</code></div><div class="line number2 index1 alt1"><code class="python plain">i </code><code class="python keyword">=</code> <code class="python value">0</code></div><div class="line number3 index2 alt2"><code class="python plain">f </code><code class="python keyword">=</code> <code class="python plain">codecs.</code><code class="python functions">open</code><code class="python plain">(</code><code class="python string">'wiki.zh.simp.seg.txt'</code><code class="python plain">,</code><code class="python string">'r'</code><code class="python plain">,encoding</code><code class="python keyword">=</code><code class="python string">"utf-8"</code><code class="python plain">)</code></div><div class="line number4 index3 alt1"><code class="python keyword">for</code> <code class="python plain">eachline </code><code class="python keyword">in</code> <code class="python plain">f:</code></div><div class="line number5 index4 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python plain">i </code><code class="python keyword">+</code><code class="python keyword">=</code> <code class="python value">1</code></div><div class="line number6 index5 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">if</code> <code class="python plain">(i &lt; </code><code class="python value">3</code><code class="python plain">):</code></div><div class="line number7 index6 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(eachline)</code></div><div class="line number8 index7 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">else</code><code class="python plain">:</code></div><div class="line number9 index8 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python keyword">break</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><img style="display: block; margin-left: auto; margin-right: auto;" src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190124145257022-964432947.png" alt=""></p>
<p>　　<span style="font-size: 14px;">其中分词结果文件<strong>wiki.zh.simp.seg.txt</strong>已经被压缩并上传云盘：</span></p>
<p>　　链接：<span style="color: #0000ff;"><a href="https://pan.baidu.com/s/15R75m5T2WlyjMagqkXbI6g" target="_blank"><span style="color: #0000ff;">https://pan.baidu.com/s/15R75m5T2WlyjMagqkXbI6g</span></a></span>&nbsp;提取码：zr46</p>
<p>&nbsp;</p>
<p>　<span style="font-size: 15px;"><strong>5）Word2Vec模型训练</strong></span></p>
<p><span style="font-size: 15px;"><strong>　　</strong><span style="font-size: 14px;">分好词的文档即可进行word2vec词向量模型的训练了。文档较大，需要内存较大，具体Python代码实现如下所示：</span></span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_62455" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">os</code></div><div class="line number2 index1 alt1"><code class="python keyword">import</code> <code class="python plain">sys</code></div><div class="line number3 index2 alt2"><code class="python keyword">import</code> <code class="python plain">logging</code></div><div class="line number4 index3 alt1"><code class="python keyword">from</code> <code class="python plain">gensim.models </code><code class="python keyword">import</code> <code class="python plain">Word2Vec</code></div><div class="line number5 index4 alt2"><code class="python keyword">from</code> <code class="python plain">gensim.models.word2vec </code><code class="python keyword">import</code> <code class="python plain">LineSentence</code></div><div class="line number6 index5 alt1"><code class="python keyword">import</code> <code class="python plain">multiprocessing</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="python plain">program </code><code class="python keyword">=</code> <code class="python plain">os.path.basename(sys.argv[</code><code class="python value">0</code><code class="python plain">])</code></div><div class="line number9 index8 alt2"><code class="python plain">logger </code><code class="python keyword">=</code> <code class="python plain">logging.getLogger(program)</code></div><div class="line number10 index9 alt1"><code class="python plain">logging.basicConfig(</code><code class="python functions">format</code><code class="python keyword">=</code><code class="python string">'%(asctime)s: %(levelname)s: %(message)s'</code><code class="python plain">,level</code><code class="python keyword">=</code><code class="python plain">logging.INFO)</code></div><div class="line number11 index10 alt2"><code class="python plain">logger.info(</code><code class="python string">"running %s"</code> <code class="python keyword">%</code> <code class="python string">' '</code><code class="python plain">.join(sys.argv))</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="python comments"># inp为输入语料, outp1 为输出模型, outp2为原始c版本word2vec的vector格式的模型</code></div><div class="line number14 index13 alt1"><code class="python plain">inp </code><code class="python keyword">=</code> <code class="python string">'wiki.zh.simp.seg.txt'</code></div><div class="line number15 index14 alt2"><code class="python plain">outp1 </code><code class="python keyword">=</code> <code class="python string">'wiki.zh.text.model'</code></div><div class="line number16 index15 alt1"><code class="python plain">outp2 </code><code class="python keyword">=</code> <code class="python string">'wiki.zh.text.vector'</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="python comments">#训练skip-gram 模型</code></div><div class="line number19 index18 alt2"><code class="python plain">model </code><code class="python keyword">=</code> <code class="python plain">Word2Vec( LineSentence(inp), size</code><code class="python keyword">=</code><code class="python value">400</code><code class="python plain">, window</code><code class="python keyword">=</code><code class="python value">5</code><code class="python plain">, min_count</code><code class="python keyword">=</code><code class="python value">5</code><code class="python plain">, workers</code><code class="python keyword">=</code><code class="python plain">multiprocessing.cpu_count() )</code></div><div class="line number20 index19 alt1"><code class="python plain">model.save(outp1)</code></div><div class="line number21 index20 alt2"><code class="python plain">model.wv.save_word2vec_format(outp2, binary</code><code class="python keyword">=</code><code class="python color1">False</code><code class="python plain">)</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>&nbsp;　　<span style="font-size: 14px;">摘取了最后几行代码运行信息，代码运行完成后得到如下四个文件，其中<strong>wiki.zh.text.model</strong>是建好的模型，<strong>wiki.zh.text.vector</strong>是词向量，是每个词对应的词向量，可以在此基础上作文本特征的提取以及分类</span></p>
<p style="text-align: center;"><span style="font-size: 14px;"><img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190124183546981-1651546325.png" alt=""></span></p>
<p style="text-align: left;"><span style="font-size: 14px;">　　其中<strong>wiki.zh.text.mode</strong>和<strong><strong>wiki.zh.text.vector</strong></strong>文件已经上传云盘：</span></p>
<p>　　<strong>wiki.zh.text.mode</strong>：<span style="color: #0000ff;"><a href="https://pan.baidu.com/s/1mlZ_5-mY3GerWnvYADt3sA" target="_blank"><span style="color: #0000ff;">https://pan.baidu.com/s/1mlZ_5-mY3GerWnvYADt3sA</span></a></span>&nbsp;提取码：7p83</p>
<p>　　<strong><strong>wiki.zh.text.vector</strong></strong>：<span style="color: #0000ff;"><a href="https://pan.baidu.com/s/16vEVQ79FkmVFwMPrA3G5mg" target="_blank"><span style="color: #0000ff;">https://pan.baidu.com/s/16vEVQ79FkmVFwMPrA3G5mg</span></a></span>&nbsp;提取码：aaa5&nbsp;</p>
<p style="text-align: left;">&nbsp;</p>
<p style="text-align: left;"><span style="font-size: 14px;">　<strong><span style="font-size: 15px;">6）模型测试</span></strong></span></p>
<p style="text-align: left;"><span style="font-size: 14px;">　　模型训练好后，来测试模型的结果</span></p>
<div class="cnblogs_Highlighter sh-gutter">
<div><div id="highlighter_822724" class="syntaxhighlighter  python"><div class="toolbar"><span><a href="#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="python keyword">import</code> <code class="python plain">warnings</code></div><div class="line number2 index1 alt1"><code class="python plain">warnings.filterwarnings(action</code><code class="python keyword">=</code><code class="python string">'ignore'</code><code class="python plain">, category</code><code class="python keyword">=</code><code class="python plain">UserWarning, module</code><code class="python keyword">=</code><code class="python string">'gensim'</code><code class="python plain">)</code><code class="python comments"># 忽略警告</code></div><div class="line number3 index2 alt2"><code class="python keyword">import</code> <code class="python plain">sys</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="python keyword">import</code> <code class="python plain">gensim</code></div><div class="line number6 index5 alt1"><code class="python plain">model </code><code class="python keyword">=</code> <code class="python plain">gensim.models.Word2Vec.load(</code><code class="python string">'wiki.zh.text.model'</code><code class="python plain">)</code></div><div class="line number7 index6 alt2"><code class="python comments">#与足球最相似的</code></div><div class="line number8 index7 alt1"><code class="python plain">word </code><code class="python keyword">=</code> <code class="python plain">model.most_similar(</code><code class="python string">"足球"</code><code class="python plain">)</code></div><div class="line number9 index8 alt2"><code class="python keyword">for</code> <code class="python plain">each </code><code class="python keyword">in</code> <code class="python plain">word:</code></div><div class="line number10 index9 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code><code class="python plain">(each[</code><code class="python value">0</code><code class="python plain">], each[</code><code class="python value">1</code><code class="python plain">])</code></div><div class="line number11 index10 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number12 index11 alt1"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number13 index12 alt2"><code class="python functions">print</code><code class="python plain">(</code><code class="python string">'*'</code> <code class="python keyword">*</code> <code class="python value">20</code><code class="python plain">)</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="python plain">word </code><code class="python keyword">=</code> <code class="python plain">model.most_similar(positive</code><code class="python keyword">=</code><code class="python plain">[</code><code class="python string">'皇上'</code><code class="python plain">,</code><code class="python string">'国王'</code><code class="python plain">],negative</code><code class="python keyword">=</code><code class="python plain">[</code><code class="python string">'皇后'</code><code class="python plain">])</code></div><div class="line number16 index15 alt1"><code class="python keyword">for</code> <code class="python plain">t </code><code class="python keyword">in</code> <code class="python plain">word:</code></div><div class="line number17 index16 alt2"><code class="python spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="python functions">print</code> <code class="python plain">(t[</code><code class="python value">0</code><code class="python plain">],t[</code><code class="python value">1</code><code class="python plain">])</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="python functions">print</code><code class="python plain">(model.doesnt_match(</code><code class="python string">'太后 妃子 贵人 贵妃 才人'</code><code class="python plain">.split(</code><code class="python string">' '</code><code class="python plain">)))</code></div><div class="line number20 index19 alt1"><code class="python functions">print</code><code class="python plain">(</code><code class="python string">'*'</code> <code class="python keyword">*</code> <code class="python value">20</code><code class="python plain">)</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="python functions">print</code><code class="python plain">(model.similarity(</code><code class="python string">'书籍'</code><code class="python plain">,</code><code class="python string">'书本'</code><code class="python plain">))</code></div><div class="line number23 index22 alt2"><code class="python functions">print</code><code class="python plain">(</code><code class="python string">'*'</code> <code class="python keyword">*</code> <code class="python value">20</code><code class="python plain">)</code></div><div class="line number24 index23 alt1"><code class="python functions">print</code><code class="python plain">(model.similarity(</code><code class="python string">'逛街'</code><code class="python plain">,</code><code class="python string">'书本'</code><code class="python plain">))</code></div></div></td></tr></tbody></table></div></div>
</div>
<p style="text-align: center;">　　<img src="https://img2018.cnblogs.com/blog/1363598/201901/1363598-20190124184025336-208134395.png" alt=""></p>
<p style="text-align: left;"><strong>　7）致谢</strong></p>
<p style="text-align: left;"><span style="font-size: 15px;">　　至此，使用python对中文wiki语料的词向量建模就全部结束了，<strong>wiki.zh.text.vector</strong>中是每个词对应的词向量，可以在此基础上作文本特征的提取以及分类</span></p>
<p style="text-align: left;"><span style="font-size: 15px;">　　本文参考：<span style="color: #0000ff;"><a href="https://github.com/AimeeLee77/wiki_zh_word2vec" target="_blank"><span style="color: #0000ff;">https://github.com/AimeeLee77/wiki_zh_word2vec</span></a></span></span></p>
<p style="text-align: left;"><span style="font-size: 15px;">　　感谢作者的分享，为后续情感分析打下了基础</span></p>
</div>

转自：https://www.cnblogs.com/always-fight/p/10310418.html